!function($){function e(){$("#associated_group_id").length&&$("#associated_group_id").val().length?$("#doc-folders").show():$("#doc-folders").hide()}function o(e){"new"==$("input[name=existing-or-new-folder]:checked").val()?$("#new-folder-block .selector-content").show():$("#new-folder-block .selector-content").hide()}function l(e){h=$("#existing-doc-id").length?$("#existing-doc-id").val():0,$.ajax({url:ajaxurl,type:"POST",data:{doc_id:h,action:"bp_docs_update_folders",group_id:e},success:function(e){$("#bp-docs-folder").replaceWith(e)}})}function t(){m.length&&(_=m.val().length?BP_Docs_Folders.folders_tab_label_groups:BP_Docs_Folders.folders_tab_label,$("#doc-folders .toggle-title").html(_))}function d(e){""==e&&(e="global"),$.ajax({url:ajaxurl,type:"POST",data:{action:"bp_docs_update_folder_type_for_group",group_id:e},success:function(o){$("#new-folder-type").fadeOut(),$("#new-folder-type").replaceWith(o).fadeIn(),a(e)}})}function a(e){var o,l;"undefined"!=typeof e&&("string"==typeof e?(o=e,l=$(".folder-parent")):(o=e.val(),l=e.siblings(".folder-parent")),$.ajax({url:ajaxurl,type:"POST",data:{action:"bp_docs_update_parent_folders",folder_type:o},success:function(e){l.fadeOut(function(){$(this).replaceWith(e).fadeIn()})}}))}function n(e){$.ajax({url:ajaxurl,type:"POST",data:{action:"bp_docs_update_folder_type",parent_id:e.val(),group_id:$("#associated_group_id").val(),type_selector_name:e.siblings(".folder-type").attr("name")},success:function(o){e.siblings(".folder-type").fadeOut(function(){$(this).replaceWith(o).fadeIn(),0!=e.val().length?e.siblings(".folder-type").prop("disabled",!0):e.siblings(".folder-type").prop("disabled",!1)})}})}function s(e){e.hasClass("folder-closed")?e.removeClass("folder-closed").addClass("folder-open"):e.removeClass("folder-open").addClass("folder-closed")}function r(e){w=e.closest(".folder"),w.hasClass("folder-edit-closed")?w.removeClass("folder-edit-closed").addClass("folder-edit-open"):w.removeClass("folder-edit-open").addClass("folder-edit-closed")}function i(){$(".doc-in-folder").draggable({revert:"invalid"}),$(".docs-folder-tree li.folder").droppable({accept:".doc-in-folder",drop:function(e,o){h=o.draggable.data("doc-id"),$.ajax({url:ajaxurl,type:"POST",data:{doc_id:h,folder_id:$(e.target).data("folder-id"),action:"bp_docs_process_folder_drop",nonce:o.draggable.find("#bp-docs-folder-drop-nonce-"+h).val()},success:function(l){1==l?f(e,o):o.draggable.removeAttr("style")}})},greedy:!0,over:function(e,o){$(e.target).addClass("hover"),u=new Date,b=u.getTime(),v=e.target,setTimeout(function(){""!==b&&""!==v&&(j=$(v),j.hasClass("folder")&&j.hasClass("folder-closed")&&(s(j),b="",v="",$(".hover").removeClass("hover")))},1500)},out:function(e,o){$(e.target).removeClass("hover"),e.target==v&&(b="",v="")}})}function c(){C&&($("#toggle-folders-hide").is(":visible")?(C.find("tr.folder-row").hide(),$("#toggle-folders-hide").hide(),$("#toggle-folders-show").show()):(C.find("tr.folder-row").show(),$("#toggle-folders-hide").show(),$("#toggle-folders-show").hide()))}function f(e,o){y=o.draggable.clone(),y.removeAttr("style"),$(e.target).children(".docs-in-folder").append(y).removeClass("empty"),0==o.draggable.siblings(".doc-in-folder").length&&o.draggable.closest(".docs-in-folder").addClass("empty"),o.draggable.remove(),$(".hover").removeClass("hover"),i()}function g(){var e=0;C.find("tr > th").each(function(o,l){var t=$(l);!t.hasClass("attachment-clip-cell")&&t.is(":visible")&&e++}),x.attr("colspan",e)}function p(e){var o=$(e).siblings(".toggle-content.folder-loop");$.trim(o.text()).length||O===!1&&(O=!0,$.ajax({url:ajaxurl,type:"GET",data:{folder:$(e).data("folder-id"),group_id:$("#directory-group-id").val(),user_id:$("#directory-user-id").val(),action:"bp_docs_get_folder_content"},success:function(e){$(o).html(e),O=!1}}))}var u,h,_="",v="",b="",m,y,C,w,x,j,O=!1;$(document).ready(function(){o($("input[name=existing-or-new-folder]")),$("input[name=existing-or-new-folder]").on("change",function(){o($(this))}),e(),m=$("#associated_group_id"),"undefined"!=typeof m.val()&&m.val().length&&d(m.val()),t(),m.on("change",function(){e(),l($(this).val()),d($(this).val()),t()}),$(".folder-type").on("change",function(){a($(this))}),$(".folder-parent").on("change",function(){n($(this))}),$(".docs-folder-tree li").on("click",function(e){return $(this).hasClass("doc-in-folder")?(e.stopPropagation(),!0):(s($(this)),!1)}),$(".docs-folder-manage li.folder h4 > span > a").on("click",function(e){return r($(this)),!1}),C=$("table.doctable"),$(".toggle-folders").on("click",function(e){e.preventDefault(),c()}),i(),x=$(".folder-row-name"),x.length>0&&(g(),$(window).resize(function(){g()})),$(".doctable").on("click",".toggle-folder",function(e){e.preventDefault(),p($(this));var o=$(this).closest(".toggleable"),l=$(this).children(".genericon-collapse, .genericon-expand").first();o.hasClass("toggle-open")?(o.removeClass("toggle-open").addClass("toggle-closed"),l.removeClass("genericon-collapse").addClass("genericon-expand")):(o.removeClass("toggle-closed").addClass("toggle-open"),l.removeClass("genericon-expand").addClass("genericon-collapse"))})})}(jQuery);